(()=>{"use strict";var e,t,n,r,a,c,o,i,u;!function(e){e[e.gain=.5]="gain",e[e.numSamples=256]="numSamples"}(e||(e={}));var s=function(e){return n.src=e},l=function(e){e?(o.frequency.setValueAtTime(1e3,t.currentTime),o.gain.setValueAtTime(25,t.currentTime)):o.gain.setValueAtTime(0,t.currentTime)},h=function(e){e?(i.frequency.setValueAtTime(1e3,t.currentTime),i.gain.setValueAtTime(15,t.currentTime)):i.gain.setValueAtTime(0,t.currentTime)},d=function(e,t){e?(u.curve=null,u.curve=f(t)):u.curve=null},f=function(e){if(void 0===e&&(e=20),0!=e){for(var t=new Float32Array(256),n=0;n<256;++n){var r=2*n/256-1;t[n]=(Math.PI+100*r/2)/(Math.PI+100*Math.abs(r)*e)}return t}},g=function(){function e(e,t){this.maxRadius=e,this.circleRadius=e,this.fillStyle="black",this.radiusScale=t}return e.prototype.update=function(e){this.circleRadius=e/255*this.maxRadius,this.fillStyle="rgb(".concat(e,",").concat(e-128,",").concat(255-e,")")},e.prototype.draw=function(e,t,n){e.save(),e.beginPath(),e.arc(t/2,n/2,this.circleRadius*this.radiusScale,0,2*Math.PI,!1),e.fillStyle=this.fillStyle,e.fill(),e.closePath(),e.restore()},e}();const m=g;var v=function(){function e(e,t,n){this.barWidth=e,this.maxBarHeight=t,this.padding=n,this.fillStyle="black",this.percent=0}return e.prototype.update=function(e){this.percent=e/255,this.percent=this.percent<.2?.02:this.percent,this.fillStyle="rgb(".concat(e,",").concat(e-128,",").concat(255-e,")")},e.prototype.draw=function(e){e.save(),e.scale(1,-1),e.fillStyle=this.fillStyle,e.fillRect(0,0,this.barWidth,this.maxBarHeight*this.percent),e.restore()},e}();const y=v;var p,S,w,b,q,T,k,M,E,A,I=1,N={useTimeDomain:!1,rotationChange:0,showBars:!0,showCircles:!0,showNoise:!1,showInvert:!1,showEmboss:!1},R=!1,B=20,C={sound1:""},F=function(e){var r=document.querySelector("#btn-fs"),a=document.querySelector("#btn-play");r.onclick=function(t){var n;((n=e).requestFullscreen||n.requestFullscreen||n.requestFullscreen||n.requestFullscreen)&&n.requestFullscreen()},a.onclick=function(e){var r=e.target;"suspended"==t.state&&t.resume(),"no"==r.dataset.playing?(n.play(),r.dataset.playing="yes",N.rotationChange=.01):(n.pause(),r.dataset.playing="no",N.rotationChange=0)};var o=document.querySelector("#volume-slider"),i=document.querySelector("#volume-label");o.oninput=function(e){var t,n=e.target;t=n.value,t=Number(t),c.gain.value=t,i.innerHTML=Math.round(Number(n.value)/2*100).toString()},o.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){var t=e.target;s(t.value),"yes"==a.dataset.playing&&a.dispatchEvent(new MouseEvent("click"))},document.querySelector("#bars-cb").onchange=function(e){var t=e.target;N.showBars=t.checked},document.querySelector("#circles-cb").onchange=function(e){var t=e.target;N.showCircles=t.checked},document.querySelector("#noise-cb").onchange=function(e){var t=e.target;N.showNoise=t.checked},document.querySelector("#invert-cb").onchange=function(e){var t=e.target;N.showInvert=t.checked},document.querySelector("#emboss-cb").onchange=function(e){var t=e.target;N.showEmboss=t.checked},document.querySelector("#domain-cb").onchange=function(e){var t=e.target;N.useTimeDomain=t.checked},document.querySelector("#upload").onchange=function(e){var t=e.target.files;s(URL.createObjectURL(t[0])),"yes"==a.dataset.playing&&a.dispatchEvent(new MouseEvent("click"))},document.querySelector("#cb-highshelf").checked=E,document.querySelector("#cb-highshelf").onchange=function(e){var t=e.target;E=t.checked,l(E)},l(E),document.querySelector("#cb-lowshelf").checked=A,document.querySelector("#cb-lowshelf").onchange=function(e){var t=e.target;A=t.checked,h(A)},h(A),document.querySelector("#cb-distortion").onchange=function(e){var t=e.target;R=t.checked,d(R,B)};var u=document.querySelector("#distortion-label");document.querySelector("#slider-distortion").value=B.toString(),document.querySelector("#slider-distortion").oninput=function(e){var t=e.target;B=Number(t.value),d(R,B),u.innerHTML=Math.round(Number(t.value)/2*100).toString()},document.querySelector("#slider-distortion").dispatchEvent(new Event("input")),d(R,B)},x=function(){setTimeout(x,1e3/60),function(e){if(e.useTimeDomain?b.getByteTimeDomainData(q):b.getByteFrequencyData(q),p.save(),p.fillStyle="#eef6fc",p.fillRect(0,0,S,w),p.restore(),p.save(),p.translate(S/2,w/2),p.rotate(I),p.scale(.5,.5),p.drawImage(T,-T.width/2,-T.height/2),p.restore(),function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}(q)>1&&(I+=e.rotationChange),e.showBars){p.save(),p.translate(S/2-M.barWidth/2,w/2-77);for(var t=0;t<q.length;t++)p.translate(M.barWidth,0),p.rotate(2*Math.PI/32),M.update(q[t]),M.draw(p);p.restore()}if(e.showCircles){for(p.save(),p.globalAlpha=.5,t=0;t<q.length;t++)for(var n=0;n<k.length;n++)k[n].update(q[t]),k[n].draw(p,S,w);p.restore()}var r=p.getImageData(0,0,S,w),a=r.data,c=a.length,o=r.width;for(t=0;t<c;t+=4)if(e.showNoise&&Math.random()<.05&&(a[t]=a[t+1]=a[t+2]=0,a[t+1]=255),e.showInvert){var i=a[t],u=a[t+1],s=a[t+3];a[t]=255-i,a[t+1]=255-u,a[t+2]=255-s}if(e.showEmboss)for(t=0;t<c;t++)t%4!=3&&(a[t]=127+2*a[t]-a[t+4]-a[t+4*o]);p.putImageData(r,0,0)}(N)};window.onload=function(){var l;(l=new XMLHttpRequest).onload=function(l){var h;try{var d=l.target;h=JSON.parse(d.responseText)}catch(e){return void console.log("JSON parsing failed")}for(var f,g,v=h.filepaths,E=h.songnames,A=document.querySelector("#track-select"),I=0;I<v.length;I++){var N=document.createElement("option");N.text=E[I],N.value=v[I],A.add(N)}C.sound1=h.defaultsong,document.title=h.title,document.querySelector("h1").innerHTML=h.title,f=C.sound1,g=window.AudioContext,t=new g,n=new Audio,s(f),r=t.createMediaElementSource(n),(a=t.createAnalyser()).fftSize=e.numSamples,(c=t.createGain()).gain.value=e.gain,(o=t.createBiquadFilter()).type="highshelf",(i=t.createBiquadFilter()).type="lowshelf",u=t.createWaveShaper(),r.connect(a),a.connect(c),c.connect(o),o.connect(i),i.connect(u),u.connect(t.destination);var R=document.querySelector("canvas");F(R),function(e,t){p=e.getContext("2d"),S=e.width,w=e.height,b=t,q=new Uint8Array(b.fftSize/2),(T=new Image).src="./media/vinyl.jpg",(k=[]).push(new m(w/4,.75)),k.push(new m(w/4,.5)),k.push(new m(w/4,.25)),M=new y(15,110,2)}(R,a),x()},l.open("GET","./data/av-data.JSON"),l.send()}})();
//# sourceMappingURL=bundle.js.map